# í…ŒìŠ¤íŠ¸ ê²€ì¦ ì›Œí¬í”Œë¡œìš° (ë…ë¦½ ì‹¤í–‰)
name: Test Validation

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›’ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ”§ pnpm ì„¤ì¹˜
        uses: pnpm/action-setup@v4
        with:
          version: latest

      - name: ğŸ“¦ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'

      - name: ğŸ“š ì˜ì¡´ì„± ì„¤ì¹˜ (ì „ì²´)
        run: pnpm install

      - name: ğŸ¨ ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ (Lint)
        run: pnpm lint

      - name: Ê¦ íƒ€ì… ê²€ì‚¬ (TypeScript)
        run: pnpm type-check

      - name: ğŸ§ª Unit í…ŒìŠ¤íŠ¸
        run: |
          echo "ğŸ§ª Unit í…ŒìŠ¤íŠ¸ ì‹œì‘..."
          # pnpmì€ ìë™ìœ¼ë¡œ node_modules/.binì„ PATHì— ì¶”ê°€í•˜ë¯€ë¡œ
          # package.jsonì˜ 'test' ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          # '-- --reporter=verbose'ëŠ” vitestì— ì¸ìë¥¼ ì „ë‹¬í•˜ì—¬ ìƒì„¸ ë¡œê·¸ë¥¼ ë´…ë‹ˆë‹¤.
          pnpm test -- --reporter=verbose
        continue-on-error: false
      - name: ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results-${{ github.run_number }}
          path: |
            test-results/
            coverage/
          retention-days: 7

      - name: âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ ì•Œë¦¼
        if: success()
        run: |
          echo "::notice title=í…ŒìŠ¤íŠ¸ ì„±ê³µ::ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ í†µê³¼í–ˆìŠµë‹ˆë‹¤! ğŸ‰"

      - name: âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì•Œë¦¼
        if: failure()
        run: |
          echo "::error title=í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨::ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
