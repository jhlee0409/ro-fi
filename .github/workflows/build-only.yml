# í…ŒìŠ¤íŠ¸ ì—†ì´ ë¹Œë“œë§Œ ìˆ˜í–‰í•˜ëŠ” ì›Œí¬í”Œë¡œìš°
name: Build Only (No Tests)

on:
  workflow_dispatch:
    inputs:
      skip_tests:
        description: 'í…ŒìŠ¤íŠ¸ ê±´ë„ˆë›°ê¸°'
        required: false
        default: true
        type: boolean

jobs:
  build-without-tests:
    runs-on: ubuntu-latest
    
    env:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      NODE_ENV: production
    
    steps:
    - name: ğŸ›’ ì²´í¬ì•„ì›ƒ ì½”ë“œ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: ğŸ”§ pnpm ì„¤ì¹˜
      uses: pnpm/action-setup@v4
      with:
        version: 8
    
    - name: ğŸ“¦ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'pnpm'
    
    - name: ğŸ“š ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        echo "ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..."
        pnpm install
        echo "âœ… ì˜ì¡´ì„± ì„¤ì¹˜ ì™„ë£Œ"
    
    - name: ğŸ—ï¸ ë¹Œë“œ ìˆ˜í–‰
      run: |
        echo "ğŸ—ï¸ Astro ë¹Œë“œ ì‹œì‘..."
        pnpm build
        echo "âœ… ë¹Œë“œ ì™„ë£Œ"
    
    - name: ğŸ§ª ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      if: github.event.inputs.skip_tests != 'true'
      run: |
        echo "ğŸš€ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰..."
        node scripts/run-automation.js --verbose
      continue-on-error: true
    
    - name: ğŸ“Š ë¹Œë“œ ê²°ê³¼ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: build-results-${{ github.run_number }}
        path: |
          dist/
          logs/
        retention-days: 7
    
    - name: âœ… ë¹Œë“œ ì„±ê³µ ì•Œë¦¼
      if: success()
      run: |
        echo "::notice title=ë¹Œë“œ ì„±ê³µ::í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰"
    
    - name: âŒ ë¹Œë“œ ì‹¤íŒ¨ ì•Œë¦¼  
      if: failure()
      run: |
        echo "::error title=ë¹Œë“œ ì‹¤íŒ¨::í”„ë¡œì íŠ¸ ë¹Œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."