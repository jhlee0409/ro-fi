name: ğŸŒŸ Gemini API ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ ìë™ ì—°ì¬ ì‹œìŠ¤í…œ v2.0

# ì™„ì „ ìƒˆë¡œìš´ Gemini API ì§ì ‘ í˜¸ì¶œ ì‹œìŠ¤í…œ
# 100% Node.js + @google/generative-ai ê¸°ë°˜
# GitHub Actions ë„¤ì´í‹°ë¸Œ ìë™í™”

on:
  # ğŸ“… ì •ê¸° ì‹¤í–‰ ìŠ¤ì¼€ì¤„ (KST ê¸°ì¤€)
  schedule:
    - cron: '0 2 * * *'   # 11:00 KST - ë©”ì¸ ì—°ì¬ ì‹œê°„
    - cron: '30 6 * * *'  # 15:30 KST - ì˜¤í›„ ì—…ë°ì´íŠ¸
    - cron: '0 12 * * *'  # 21:00 KST - ì €ë… ì—°ì¬
  
  # ğŸ® ìˆ˜ë™ ì‹¤í–‰ (workflow_dispatch)
  workflow_dispatch:
    inputs:
      generation_mode:
        description: 'ğŸ“š ìƒì„± ëª¨ë“œ ì„ íƒ'
        required: true
        default: 'auto'
        type: choice
        options:
          - auto          # ìë™ ìš°ì„ ìˆœìœ„ íŒë‹¨
          - new_novel     # ìƒˆ ì†Œì„¤ ê°•ì œ ìƒì„±
          - continue_chapter # ê¸°ì¡´ ì†Œì„¤ ì—°ì¬
          - complete_novel   # ì†Œì„¤ ì™„ê²° ì²˜ë¦¬
      
      creativity_level:
        description: 'ğŸ¨ ì°½ì˜ì„± ë ˆë²¨'
        required: false
        default: 'high'
        type: choice
        options:
          - low    # ì•ˆì •ì , ì˜ˆì¸¡ ê°€ëŠ¥í•œ ìŠ¤íƒ€ì¼
          - medium # ê· í˜•ì¡íŒ ì°½ì˜ì„±
          - high   # ìµœëŒ€ ì°½ì˜ì„±, ë…ì°½ì  í‘œí˜„
      
      target_genre:
        description: 'ğŸ“– íƒ€ê²Ÿ ì¥ë¥´ (ìƒˆ ì†Œì„¤ ìƒì„±ì‹œ)'
        required: false
        default: 'í™©ì‹¤ë¡œë§¨ìŠ¤'
        type: choice
        options:
          - í™©ì‹¤ë¡œë§¨ìŠ¤
          - ë§ˆë²•ì•„ì¹´ë°ë¯¸
          - ê¸°ì‚¬ì™€ê·€ì¡±
          - ìš©ì¡±í™©ì œ
          - ë§ˆë„ì‚¬í•™ì›
          - ì—˜í”„ì™•êµ­
          - ì‹œê°„ì—¬í–‰ì
          - ì „ìƒê·€ì¡±ì˜ì• 
          - ë§ˆíƒ‘ì˜ë§ˆë²•ì‚¬
          - ì‹ ì „ì˜ì„±ë…€

      dry_run:
        description: 'ğŸ” í…ŒìŠ¤íŠ¸ ëª¨ë“œ (ì‹¤ì œ íŒŒì¼ ìƒì„± ì•ˆí•¨)'
        required: false
        default: false
        type: boolean

# ë™ì‹œ ì‹¤í–‰ ì œí•œ (ì•ˆì „ì„± ë³´ì¥)
concurrency:
  group: gemini-api-novel-automation-${{ github.ref }}
  cancel-in-progress: false

jobs:
  # =====================================
  # ë©”ì¸ ì‘ì—…: Gemini API ìë™ ì—°ì¬
  # =====================================
  gemini-api-automation:
    name: ğŸ¤– Gemini API ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ ìë™ ì—°ì¬
    runs-on: ubuntu-latest
    
    # í•„ìš”í•œ ê¶Œí•œë“¤
    permissions:
      contents: write        # íŒŒì¼ ìƒì„±/ìˆ˜ì •
      pull-requests: write   # PR ìƒì„± (í–¥í›„ í™•ì¥)
      issues: write         # ì´ìŠˆ ìƒì„± (ì—ëŸ¬ ë¦¬í¬íŒ…)
      id-token: write       # OIDC í† í°
    
    # í™˜ê²½ë³€ìˆ˜ ì„¤ì •
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      NODE_ENV: production
      GENERATION_MODE: ${{ github.event.inputs.generation_mode || 'auto' }}
      CREATIVITY_LEVEL: ${{ github.event.inputs.creativity_level || 'high' }}
      TARGET_GENRE: ${{ github.event.inputs.target_genre || 'í™©ì‹¤ë¡œë§¨ìŠ¤' }}
      DRY_RUN: ${{ github.event.inputs.dry_run || 'false' }}
      TZ: Asia/Seoul
    
    steps:
      # =====================================
      # 1. í™˜ê²½ ì¤€ë¹„
      # =====================================
      - name: ğŸ“¥ ì†ŒìŠ¤ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ì „ì²´ íˆìŠ¤í† ë¦¬ (ë¶„ì„ìš©)
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸ“¦ Node.js í™˜ê²½ ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'pnpm'
      
      - name: ğŸ“¦ pnpm ì„¤ì¹˜
        uses: pnpm/action-setup@v4
        with:
          version: 8
      
      - name: ğŸ”§ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          echo "ğŸ”§ pnpmìœ¼ë¡œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
          pnpm install --frozen-lockfile
          echo "âœ… ì„¤ì¹˜ ì™„ë£Œ: $(pnpm list --depth=0 | wc -l) íŒ¨í‚¤ì§€"
      
      # =====================================
      # 2. í™˜ê²½ ê²€ì¦
      # =====================================
      - name: ğŸ” API í‚¤ ê²€ì¦
        run: |
          echo "ğŸ” í™˜ê²½ë³€ìˆ˜ í™•ì¸:"
          echo "- NODE_ENV: $NODE_ENV"
          echo "- GEMINI_API_KEY ì¡´ì¬ ì—¬ë¶€: $([ -n "$GEMINI_API_KEY" ] && echo 'âœ… ì„¤ì •ë¨' || echo 'âŒ ì—†ìŒ')"
          echo "- GEMINI_API_KEY ê¸¸ì´: ${#GEMINI_API_KEY}"
          
          if [ -z "$GEMINI_API_KEY" ]; then
            echo "âŒ GEMINI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
            echo "GitHub Secretsì—ì„œ GEMINI_API_KEYë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”"
            echo "í˜„ì¬ ì„¤ì •ëœ í™˜ê²½ë³€ìˆ˜:"
            env | grep -E "(NODE_ENV|GEMINI|API)" || echo "ê´€ë ¨ í™˜ê²½ë³€ìˆ˜ ì—†ìŒ"
            exit 1
          fi
          echo "âœ… Gemini API í‚¤ í™•ì¸ ì™„ë£Œ"
      
      - name: ğŸ§ª GitHub í™˜ê²½ ì™„ì „ì„± í…ŒìŠ¤íŠ¸
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          echo "ğŸ§ª GitHub Actions í™˜ê²½ì—ì„œ Gemini API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘..."
          node scripts/test-github-environment.js
      
      - name: ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡° í™•ì¸
        run: |
          echo "ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸:"
          echo "- ì†Œì„¤ ë””ë ‰í† ë¦¬: $([ -d src/content/novels ] && echo 'âœ…' || echo 'âŒ') src/content/novels"
          echo "- ì±•í„° ë””ë ‰í† ë¦¬: $([ -d src/content/chapters ] && echo 'âœ…' || echo 'âŒ') src/content/chapters"
          echo "- ìŠ¤í¬ë¦½íŠ¸: $([ -f scripts/ai-novel-generator.js ] && echo 'âœ…' || echo 'âŒ') scripts/ai-novel-generator.js"
          
          # ë””ë ‰í† ë¦¬ ìƒì„± (ì—†ëŠ” ê²½ìš°)
          mkdir -p src/content/novels src/content/chapters logs
          echo "âœ… í•„ìˆ˜ ë””ë ‰í† ë¦¬ ì¤€ë¹„ ì™„ë£Œ"
      
      # =====================================
      # 3. Git ì‚¬ìš©ì ì„¤ì •
      # =====================================
      - name: ğŸ‘¤ Git ì‚¬ìš©ì ì„¤ì •
        run: |
          git config --global user.name "ë¡œíŒ ìë™í™” ë´‡ ğŸ¤–"
          git config --global user.email "gemini-automation@github.com"
          git config --global init.defaultBranch main
          echo "âœ… Git ì„¤ì • ì™„ë£Œ"
      
      # =====================================
      # 4. í˜„ì¬ ìƒíƒœ ë¶„ì„ ë° ë¡œê¹…
      # =====================================
      - name: ğŸ“Š í˜„ì¬ ì—°ì¬ ìƒí™© ë¶„ì„
        id: analyze
        run: |
          echo "ğŸ“Š í˜„ì¬ ì—°ì¬ ìƒí™© ë¶„ì„ ì¤‘..."
          
          NOVEL_COUNT="$(find src/content/novels -name "*.md" 2>/dev/null | wc -l || echo "0")"
          CHAPTER_COUNT="$(find src/content/chapters -name "*.md" 2>/dev/null | wc -l || echo "0")"
          
          echo "í˜„ì¬ ìƒí™©:"
          echo "- ì´ ì†Œì„¤ ìˆ˜: $NOVEL_COUNT"
          echo "- ì´ ì±•í„° ìˆ˜: $CHAPTER_COUNT"
          
          if [ "$NOVEL_COUNT" -gt 0 ]; then
            echo "ğŸ“š ê¸°ì¡´ ì†Œì„¤ ëª©ë¡:"
            find src/content/novels -name "*.md" 2>/dev/null | while read file; do
              echo "  - $(basename "$file" .md)"
            done
          fi
          
          if [ "$CHAPTER_COUNT" -gt 0 ]; then
            echo "ğŸ“– ìµœê·¼ ì±•í„° (ìµœëŒ€ 5ê°œ):"
            find src/content/chapters -name "*.md" 2>/dev/null | head -5 | while read file; do
              echo "  - $(basename "$file")"
            done
          fi
          
          # GitHub ì¶œë ¥ìœ¼ë¡œ ì„¤ì •
          echo "novel_count=$NOVEL_COUNT" >> $GITHUB_OUTPUT
          echo "chapter_count=$CHAPTER_COUNT" >> $GITHUB_OUTPUT
          
          echo "âœ… ë¶„ì„ ì™„ë£Œ"
      
      # =====================================
      # 5. ë©”ì¸ AI ì‹¤í–‰
      # =====================================
      - name: ğŸ¤– Gemini AI ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ ìƒì„± ì‹¤í–‰
        id: generate
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          NODE_ENV: ${{ env.NODE_ENV }}
        run: |
          echo "ğŸŒŸ Gemini API ìë™ ì—°ì¬ ì‹œì‘"
          echo "ì„¤ì •:"
          echo "  - ëª¨ë“œ: $GENERATION_MODE"
          echo "  - ì°½ì˜ì„±: $CREATIVITY_LEVEL"
          echo "  - ì¥ë¥´: $TARGET_GENRE"
          echo "  - í…ŒìŠ¤íŠ¸ ëª¨ë“œ: $DRY_RUN"
          echo ""
          echo "ğŸ”§ í™˜ê²½ë³€ìˆ˜ ì¬í™•ì¸:"
          echo "  - GEMINI_API_KEY: $([ -n "$GEMINI_API_KEY" ] && echo 'âœ… ìˆìŒ' || echo 'âŒ ì—†ìŒ')"
          echo "  - NODE_ENV: $NODE_ENV"
          echo ""
          
          # ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
          START_TIME="$(date +%s)"
          
          # Gemini AI ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
          if [ "$DRY_RUN" = "true" ]; then
            echo "ğŸ” í…ŒìŠ¤íŠ¸ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘..."
            node scripts/ai-novel-generator.js \
              --mode "$GENERATION_MODE" \
              --creativity "$CREATIVITY_LEVEL" \
              --dry-run \
              --verbose
          else
            echo "ğŸš€ ì‹¤ì œ ìƒì„± ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘..."
            node scripts/ai-novel-generator.js \
              --mode "$GENERATION_MODE" \
              --creativity "$CREATIVITY_LEVEL" \
              --verbose
          fi
          
          EXECUTION_RESULT=$?
          END_TIME="$(date +%s)"
          DURATION=$((END_TIME - START_TIME))
          
          echo ""
          echo "â±ï¸ ì‹¤í–‰ ì‹œê°„: ${DURATION}ì´ˆ"
          
          if [ "$EXECUTION_RESULT" -eq 0 ]; then
            echo "âœ… Gemini AI ìƒì„± ì„±ê³µ!"
            echo "success=true" >> $GITHUB_OUTPUT
          else
            echo "âŒ Gemini AI ìƒì„± ì‹¤íŒ¨ (ì¢…ë£Œ ì½”ë“œ: $EXECUTION_RESULT)"
            echo "success=false" >> $GITHUB_OUTPUT
            exit "$EXECUTION_RESULT"
          fi
      
      # =====================================
      # 6. ìƒì„± ê²°ê³¼ í™•ì¸
      # =====================================
      - name: ğŸ“‹ ìƒì„± ê²°ê³¼ í™•ì¸
        if: steps.generate.outputs.success == 'true'
        run: |
          echo "ğŸ“‹ ìƒì„± í›„ ìƒíƒœ í™•ì¸:"
          
          NEW_NOVEL_COUNT="$(find src/content/novels -name "*.md" 2>/dev/null | wc -l || echo "0")"
          NEW_CHAPTER_COUNT="$(find src/content/chapters -name "*.md" 2>/dev/null | wc -l || echo "0")"
          
          echo "ì—…ë°ì´íŠ¸ í›„:"
          echo "- ì´ ì†Œì„¤ ìˆ˜: $NEW_NOVEL_COUNT (ì´ì „: ${{ steps.analyze.outputs.novel_count }})"
          echo "- ì´ ì±•í„° ìˆ˜: $NEW_CHAPTER_COUNT (ì´ì „: ${{ steps.analyze.outputs.chapter_count }})"
          
          NOVELS_ADDED="$((NEW_NOVEL_COUNT - ${{ steps.analyze.outputs.novel_count }}))"
          CHAPTERS_ADDED="$((NEW_CHAPTER_COUNT - ${{ steps.analyze.outputs.chapter_count }}))"
          
          echo "ë³€ê²½ì‚¬í•­:"
          echo "- ì¶”ê°€ëœ ì†Œì„¤: $NOVELS_ADDED"
          echo "- ì¶”ê°€ëœ ì±•í„°: $CHAPTERS_ADDED"
          
          # ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ë“¤ í‘œì‹œ
          if [ "$NOVELS_ADDED" -gt 0 ] || [ "$CHAPTERS_ADDED" -gt 0 ]; then
            echo ""
            echo "ğŸ†• ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ë“¤:"
            git status --porcelain | grep "^A" | sed 's/^A  /  + /' || echo "  (Gitìœ¼ë¡œ ì¶”ì ë˜ì§€ ì•ŠëŠ” ìƒˆ íŒŒì¼ë“¤)"
          fi
          
          echo "âœ… ê²°ê³¼ í™•ì¸ ì™„ë£Œ"
      
      # =====================================
      # 7. ë¡œê·¸ íŒŒì¼ ì²˜ë¦¬
      # =====================================
      - name: ğŸ“ ì‹¤í–‰ ë¡œê·¸ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: automation-logs-${{ github.run_id }}
          path: logs/
          retention-days: 30
      
      # =====================================
      # 8. Git ì»¤ë°‹ ë° í‘¸ì‹œ (DRY RUNì´ ì•„ë‹Œ ê²½ìš°ë§Œ)
      # =====================================
      - name: ğŸ“¤ Git ì»¤ë°‹ ë° í‘¸ì‹œ
        if: steps.generate.outputs.success == 'true' && github.event.inputs.dry_run != 'true'
        run: |
          echo "ğŸ“¤ ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ ì¤‘..."
          
          # ë³€ê²½ëœ íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
          if [ -z "$(git status --porcelain)" ]; then
            echo "â„¹ï¸ ë³€ê²½ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ì»¤ë°‹ì„ ê±´ë„ˆëœë‹ˆë‹¤."
            exit 0
          fi
          
          # ì†Œì„¤ ë° ì±•í„° íŒŒì¼ë§Œ ì¶”ê°€
          git add src/content/novels/ src/content/chapters/
          
          # ì»¤ë°‹ ë©”ì‹œì§€ ìƒì„±
          TIMESTAMP="$(date '+%Y-%m-%d %H:%M:%S KST')"
          MODE_KOREAN=""
          case "$GENERATION_MODE" in
            "auto") MODE_KOREAN="ìë™ íŒë‹¨" ;;
            "new_novel") MODE_KOREAN="ìƒˆ ì†Œì„¤ ìƒì„±" ;;
            "continue_chapter") MODE_KOREAN="ì±•í„° ì—°ì¬" ;;
            "complete_novel") MODE_KOREAN="ì†Œì„¤ ì™„ê²°" ;;
            *) MODE_KOREAN="$GENERATION_MODE" ;;
          esac
          
          COMMIT_MSG="ğŸŒŸ Gemini API ìë™ ì—°ì¬: ${MODE_KOREAN}
          
          ğŸ“Š ì‹¤í–‰ ì •ë³´:
          - ëª¨ë“œ: ${GENERATION_MODE}
          - ì°½ì˜ì„±: ${CREATIVITY_LEVEL}
          - ì¥ë¥´: ${TARGET_GENRE}
          - ì‹¤í–‰ ì‹œê°„: ${TIMESTAMP}
          - ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}
          - ì‹¤í–‰ ID: ${{ github.run_id }}
          
          ğŸ¤– ì‹œìŠ¤í…œ ì •ë³´:
          - Gemini API ì§ì ‘ í˜¸ì¶œ (100% ë„¤ì´í‹°ë¸Œ)
          - google/generative-ai v0.21.0
          - Node.js ê¸°ë°˜ ì™„ì „ ìë™í™”
          - í”„ë¡œë•ì…˜ í’ˆì§ˆ ë¡œë§¨ìŠ¤ íŒíƒ€ì§€
          
          âœ¨ íŠ¹ì§•:
          - ìŠ¤ë§ˆíŠ¸ ìš°ì„ ìˆœìœ„ ë¡œì§ (ì™„ê²° > ì—°ì¬ > ì‹ ê·œ)
          - ê³ í’ˆì§ˆ ë©”íƒ€ë°ì´í„° ìë™ ê´€ë¦¬
          - ê°ì •ì  ê¹Šì´ì™€ ëª°ì…ê° ìˆëŠ” ìŠ¤í† ë¦¬í…”ë§
          - ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ ì „ë¬¸ íŠ¸ë¡œí”„ í™œìš©
          - Geminiì˜ ê¸´ ì»¨í…ìŠ¤íŠ¸ì™€ ë¹ ë¥¸ ì‘ë‹µ í™œìš©
          
          Co-Authored-By: Gemini AI <gemini@google.com>
          Generated-By: GitHub Actions Automation"
          
          git commit -m "$COMMIT_MSG"
          
          # í‘¸ì‹œ ì‹œë„
          echo "ğŸš€ GitHubì— í‘¸ì‹œ ì¤‘..."
          git push origin main
          
          echo "âœ… ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ!"
          COMMIT_SHA="$(git rev-parse HEAD)"
          echo "ğŸ”— ë³€ê²½ì‚¬í•­: https://github.com/${{ github.repository }}/commit/${COMMIT_SHA}"
      
      # =====================================
      # 9. Vercel ìë™ ë°°í¬
      # =====================================
      - name: ğŸš€ Vercel ë°°í¬
        if: steps.generate.outputs.success == 'true' && github.event.inputs.dry_run != 'true'
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
        run: |
          echo "ğŸš€ Vercel ë°°í¬ ì‹œì‘..."
          
          # Vercel CLI ì„¤ì¹˜
          echo "ğŸ“¦ Vercel CLI ì„¤ì¹˜ ì¤‘..."
          pnpm add -g vercel@latest
          
          # ë°°í¬ ì „ ë¹Œë“œ
          echo "ğŸ”¨ í”„ë¡œì íŠ¸ ë¹Œë“œ ì¤‘..."
          pnpm build || echo "ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì—†ê±°ë‚˜ ì‹¤íŒ¨ (Vercelì—ì„œ ë¹Œë“œë¨)"
          
          # í”„ë¡œë•ì…˜ ë°°í¬
          echo "ğŸŒ Vercel í”„ë¡œë•ì…˜ ë°°í¬ ì¤‘..."
          vercel --token="$VERCEL_TOKEN" --prod --yes --scope="$VERCEL_ORG_ID" || {
            echo "âš ï¸ Vercel ë°°í¬ ì‹¤íŒ¨. ìˆ˜ë™ ë°°í¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
            echo "GitHub í‘¸ì‹œëŠ” ì„±ê³µí–ˆìœ¼ë¯€ë¡œ Vercelì´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ë°°í¬í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤."
          }
          
          echo "âœ… Vercel ë°°í¬ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!"
          echo "ğŸ”— ë°°í¬ URL: https://ro-fi.vercel.app"
      
      # =====================================
      # 10. ì‹¤í–‰ ì™„ë£Œ ìš”ì•½
      # =====================================
      - name: ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
        if: always()
        run: |
          echo ""
          echo "ğŸ‰======================================"
          echo "ğŸ“Š Gemini API ìë™ ì—°ì¬ ì‹¤í–‰ ì™„ë£Œ"
          echo "======================================ğŸ‰"
          echo ""
          echo "ğŸ“‹ ì‹¤í–‰ ì •ë³´:"
          echo "  - ëª¨ë“œ: $GENERATION_MODE"
          echo "  - ì°½ì˜ì„±: $CREATIVITY_LEVEL"
          echo "  - ì¥ë¥´: $TARGET_GENRE"
          echo "  - í…ŒìŠ¤íŠ¸ ëª¨ë“œ: $DRY_RUN"
          echo "  - ì‹¤í–‰ ì‹œê°„: $(date '+%Y-%m-%d %H:%M:%S KST')"
          echo ""
          echo "ğŸ“ˆ ìƒíƒœ:"
          echo "  - ìƒì„± ì„±ê³µ: ${{ steps.generate.outputs.success || 'false' }}"
          echo "  - ì†Œì„¤ ìˆ˜: ${{ steps.analyze.outputs.novel_count || '0' }}"
          echo "  - ì±•í„° ìˆ˜: ${{ steps.analyze.outputs.chapter_count || '0' }}"
          echo ""
          echo "ğŸ”— ìœ ìš©í•œ ë§í¬:"
          echo "  - ì›Œí¬í”Œë¡œìš°: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo "  - ë°°í¬ ì‚¬ì´íŠ¸: https://ro-fi.vercel.app"
          echo "  - ì†Œì„¤ ë³´ê¸°: https://github.com/${{ github.repository }}/tree/main/src/content/novels"
          echo "  - ì±•í„° ë³´ê¸°: https://github.com/${{ github.repository }}/tree/main/src/content/chapters"
          echo ""
          
          if [ "${{ steps.generate.outputs.success }}" = "true" ]; then
            echo "âœ… ìë™ ì—°ì¬ ì‹œìŠ¤í…œì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            echo "ğŸŒŸ ìƒˆë¡œìš´ ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ ì½˜í…ì¸ ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!"
          else
            echo "âŒ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
            echo "ğŸ“ ë¡œê·¸ íŒŒì¼ì„ í™•ì¸í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì„¸ìš”."
          fi
          
          echo ""
          echo "ğŸ¤– Gemini API ìë™ ì—°ì¬ ì‹œìŠ¤í…œ v2.0"
          echo "ğŸ’ ìµœê³  í’ˆì§ˆì˜ ë¡œë§¨ìŠ¤ íŒíƒ€ì§€ë¥¼ ì„ ì‚¬í•©ë‹ˆë‹¤"

  # =====================================
  # ì‹¤íŒ¨ ì‹œ ì•Œë¦¼ ì‘ì—…
  # =====================================
  notify-failure:
    name: ğŸš¨ ì‹¤íŒ¨ ì•Œë¦¼
    runs-on: ubuntu-latest
    needs: gemini-api-automation
    if: failure()
    
    steps:
      - name: ğŸš¨ ì‹¤íŒ¨ ì´ìŠˆ ìƒì„±
        uses: actions/github-script@v7
        with:
          script: |
            const title = `ğŸš¨ ìë™ ì—°ì¬ ì‹¤íŒ¨ - ${new Date().toLocaleDateString('ko-KR')}`;
            const body = `
            ## ğŸš¨ Gemini API ìë™ ì—°ì¬ ì‹¤íŒ¨
            
            **ì‹¤í–‰ ì •ë³´:**
            - ì›Œí¬í”Œë¡œìš°: ${{ github.workflow }}
            - ì‹¤í–‰ ID: ${{ github.run_id }}
            - ëª¨ë“œ: ${{ github.event.inputs.generation_mode || 'auto' }}
            - ì°½ì˜ì„±: ${{ github.event.inputs.creativity_level || 'high' }}
            - ì‹¤í–‰ ì‹œê°„: ${new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}
            
            **í™•ì¸ ì‚¬í•­:**
            - [ ] GEMINI_API_KEY ì‹œí¬ë¦¿ ì„¤ì • í™•ì¸
            - [ ] API í• ë‹¹ëŸ‰ í™•ì¸
            - [ ] ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸
            - [ ] ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜ ë¡œê·¸ í™•ì¸
            
            **ë¡œê·¸ í™•ì¸:**
            [ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ë¡œê·¸](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
            
            ---
            *ìë™ ìƒì„±ëœ ì´ìŠˆì…ë‹ˆë‹¤. ë¬¸ì œ í•´ê²° í›„ ì´ìŠˆë¥¼ ë‹«ì•„ì£¼ì„¸ìš”.*
            `;
            
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['bug', 'automation', 'gemini-api']
            });