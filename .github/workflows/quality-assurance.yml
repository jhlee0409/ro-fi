# BASE.md 품질 보증 시스템: 7.5/10 이상 필수
name: Quality Assurance Check

on:
  push:
    paths: 
      - "src/content/chapters/**/*.md"
      - "src/content/novels/**/*.md"
  workflow_dispatch:

jobs:
  quality-check:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 2  # 최신 2개 커밋 비교

      - name: AI Quality Review with Claude Code
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          direct_prompt: |
            # 로맨스 판타지 품질 검증 시스템

            ## 목표: 새로 생성된 챕터들의 품질을 로판 독자 기준으로 검증

            ## 1단계: 변경된 파일 확인
            - 최근 커밋에서 수정/추가된 .md 파일들 식별
            - src/content/chapters/ 내의 새 챕터 파일들 우선 검토

            ## 2단계: 로맨스 판타지 품질 평가 (각 항목 0-10점)

            ### 평가 기준:
            1. **마크다운 포맷 준수** (0-10점) ⭐ **필수**
               - 대화체: `> "내용"` 형식 준수 여부
               - 독백: `> *'내용'*` 형식 준수 여부  
               - 액션: `> [행동설명]` 형식 준수 여부
               - 서술: 중요 키워드 **볼드** 처리 여부
               - 한 줄에 하나 요소만 포함 원칙 준수
               - 따옴표 규칙 (대화=", 독백=') 준수

            2. **로맨스 몰입도** (0-10점)
               - 주인공들 간의 감정적 긴장감
               - 로맨틱한 상황과 대화의 자연스러움
               - 독자의 설렘 유발 정도

            3. **판타지 세계관 일관성** (0-10점)
               - 마법/판타지 설정의 논리성
               - 이전 챕터와의 설정 연속성
               - 세계관 내 규칙 준수

            4. **캐릭터 매력도** (0-10점)
               - 주인공/조연의 개성과 매력
               - 캐릭터 행동의 일관성
               - 대화와 행동의 개연성

            5. **문장 가독성** (0-10점)
               - 문법과 맞춤법 정확성
               - 문장의 자연스러움과 유려함
               - 적절한 문체와 어조

            6. **다음화 기대감** (0-10점)
               - 클리프행어의 효과성
               - 스토리 진행의 흥미로움
               - 독자의 궁금증 유발

            ## 3단계: 점수 계산 및 판정
            - 총점 = (각 항목 점수 합계) / 6
            - **합격 기준: 7.5/10 이상**
            - **마크다운 포맷 준수는 8.0/10 이상 필수** (포맷 불일치 시 자동 재작성)
            - 불합격 시 구체적인 개선 사항 제시

            ## 4단계: 결과 처리
            ### 합격 (7.5점 이상):
            - ✅ 품질 검증 통과 코멘트 추가
            - 정식 배포 승인

            ### 불합격 (7.5점 미만):
            - ❌ 품질 개선 필요 이슈 생성
            - 구체적인 문제점과 개선 방향 제시
            - 재생성 요청 플래그 설정

            ## 5단계: 자동 개선 (선택사항)
            7.0점 이상 7.5점 미만인 경우:
            - 지적된 문제점을 자동으로 수정 시도
            - 수정된 버전으로 파일 업데이트

            ## 실행 명령
            위 기준으로 최근 추가/수정된 로맨스 판타지 챕터들을 지금 검증하세요.
            각 챕터별로 상세한 점수와 평가 이유를 제공하고, 필요시 개선 사항을 구체적으로 제안하세요.

      - name: Quality Report Summary
        run: |
          echo "📊 품질 검증 완료"
          echo "🎯 로맨스 판타지 특화 검증 실시"
          echo "📋 합격 기준: 7.5/10 이상"
          echo "📈 검증 항목: 로맨스몰입도/판타지일관성/캐릭터매력도/문장가독성/기대감"