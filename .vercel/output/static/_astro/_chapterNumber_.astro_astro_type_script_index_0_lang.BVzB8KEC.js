const h=document.getElementById("settingsBtn"),c=document.getElementById("settingsPanel"),s=document.getElementById("chapter-content"),d=document.getElementById("main-content"),n=document.getElementById("navbar");h?.addEventListener("click",()=>{c?.classList.contains("translate-x-full")?(c.classList.remove("translate-x-full"),c.classList.add("translate-x-0")):(c?.classList.add("translate-x-full"),c?.classList.remove("translate-x-0"))});document.addEventListener("click",r=>{const l=r.target;!c?.contains(l)&&!h?.contains(l)&&(c?.classList.add("translate-x-full"),c?.classList.remove("translate-x-0"))});const u=document.querySelectorAll(".font-size-btn");u.forEach(r=>{r.addEventListener("click",l=>{const a=l.target,o=a.dataset.size;s&&o&&(s.style.fontSize=o+"px"),u.forEach(e=>{e.classList.remove("active","bg-purple-600","text-white"),e.classList.add("bg-gray-100")}),a.classList.add("active","bg-purple-600","text-white"),a.classList.remove("bg-gray-100"),o&&localStorage.setItem("reading-font-size",o)})});const y=document.querySelectorAll(".line-height-btn");y.forEach(r=>{r.addEventListener("click",l=>{const a=l.target,o=a.dataset.height;s&&o&&(s.style.lineHeight=o),y.forEach(e=>{e.classList.remove("active","bg-purple-600","text-white"),e.classList.add("bg-gray-100")}),a.classList.add("active","bg-purple-600","text-white"),a.classList.remove("bg-gray-100"),o&&localStorage.setItem("reading-line-height",o)})});const b=document.querySelectorAll(".theme-btn");b.forEach(r=>{r.addEventListener("click",l=>{const a=l.target,o=a.dataset.theme;o==="light"&&d&&s&&n?(d.className="pt-16 min-h-screen bg-white transition-colors duration-300",s.className="prose prose-lg max-w-none leading-relaxed text-gray-900",n.className="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-lg border-b border-gray-200 transition-all duration-300"):o==="sepia"&&d&&s&&n?(d.className="pt-16 min-h-screen bg-amber-50 transition-colors duration-300",s.className="prose prose-lg max-w-none leading-relaxed text-amber-900",n.className="fixed top-0 left-0 right-0 z-50 bg-amber-50/95 backdrop-blur-lg border-b border-amber-200 transition-all duration-300"):o==="dark"&&d&&s&&n&&(d.className="pt-16 min-h-screen bg-gray-900 transition-colors duration-300",s.className="prose prose-lg max-w-none leading-relaxed text-gray-100",n.className="fixed top-0 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-lg border-b border-gray-700 transition-all duration-300"),b.forEach(e=>{e.classList.remove("active");const t=e;o==="light"&&(e.classList.remove("bg-white","bg-amber-50","bg-gray-800"),e.classList.add(t.dataset.theme==="light"?"bg-white":t.dataset.theme==="sepia"?"bg-amber-50":"bg-gray-800"))}),a.classList.add("active"),o&&localStorage.setItem("reading-theme",o)})});let f=window.scrollY;window.addEventListener("scroll",()=>{const r=window.scrollY;r>f&&r>100&&n?n.style.transform="translateY(-100%)":n&&(n.style.transform="translateY(0)"),f=r});function k(){console.log("소설 콘텐츠 스타일링 함수 실행됨");const r=document.querySelector(".novel-content");if(!r)return;const l=r.querySelectorAll("p");console.log("찾은 단락 수:",l.length),l.forEach(e=>{const t=e.textContent||"",g=e.innerHTML||"";e.className="",(t.includes('"')||t.includes('"')||t.includes('"'))&&(t.match(/[!?！？]/g)||[]).length>=2?(console.log("강조 대화체 감지됨:",t),e.className="text-red-600 dark:text-red-400 font-semibold px-6 py-4 my-5 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 rounded-r-lg"):t.includes('"')||t.includes('"')||t.includes('"')?(console.log("대화체 감지됨:",t),e.className="text-emerald-700 dark:text-emerald-400 font-medium px-6 py-4 my-5 bg-emerald-50 dark:bg-emerald-900/20 border-l-4 border-emerald-500 rounded-r-lg"):t.includes("...")&&(t.includes("'")||g.includes("<em>")||/생각|마음|느꼈다|떠올랐다|상상했다|머릿속|뇌리/.test(t))?(console.log("내면의 목소리 감지됨:",t),e.className="text-blue-700 dark:text-blue-400 italic px-6 py-4 my-5 bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 rounded-r-lg"):t.includes("'")&&t.includes("'")||g.includes("<em>")&&g.includes("</em>")&&!g.includes("<strong>")?(console.log("독백체 감지됨:",t),e.className="text-purple-700 dark:text-purple-400 italic px-6 py-4 my-5 bg-purple-50 dark:bg-purple-900/20 border-l-4 border-purple-500 rounded-r-lg"):t.includes("[")&&t.includes("]")?(console.log("액션 감지됨:",t),e.className="text-gray-600 dark:text-gray-400 italic text-sm px-4 py-3 my-4 bg-gray-50 dark:bg-gray-800/50 border-l-4 border-gray-400 rounded-r-md opacity-90"):/^(그는|그녀는|그들은|그가|그녀가|아리엘|카엘|엘리아나)?\s*(걸었다|뛰었다|돌아봤다|웃었다|울었다|떨었다|일어났다|앉았다|서있었다|들어왔다|나갔다|바라봤다|고개를|손을|눈을|문이|창문이)/i.test(t)?(console.log("동작 서술 감지됨:",t),e.className="text-gray-600 dark:text-gray-400 italic text-sm px-4 py-3 my-4 bg-gray-50 dark:bg-gray-800/50 border-l-4 border-gray-400 rounded-r-md opacity-90"):(console.log("일반 서술:",t),e.className="text-gray-900 dark:text-gray-100 leading-relaxed my-6"),e.querySelectorAll("strong").forEach(m=>{m.closest("blockquote")||(m.className="font-bold text-gray-900 dark:text-gray-100 bg-yellow-100 dark:bg-yellow-900/30 px-1 py-0.5 rounded")}),e.querySelectorAll("em").forEach(m=>{m.closest("blockquote")||(m.className="italic text-purple-600 dark:text-purple-400 font-medium")})}),r.querySelectorAll("blockquote").forEach(e=>{const t=e.textContent||"";if(e.querySelectorAll("p").forEach(i=>{i.className="text-inherit leading-relaxed m-0"}),e.querySelectorAll("em").forEach(i=>{i.className="italic font-normal"}),/경고|예언|운명|고대|신탁|마법|룬|의식/.test(t)){if(e.className="my-6 px-6 py-5 bg-gradient-to-r from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30 border-l-4 border-amber-600 rounded-r-lg italic text-amber-900 dark:text-amber-200 font-medium relative overflow-hidden",!e.querySelector(".quote-decoration")){const i=document.createElement("span");i.textContent='"',i.className="quote-decoration absolute -top-2 left-2 text-6xl opacity-10 font-serif pointer-events-none",e.prepend(i)}}else e.className="my-6 px-6 py-4 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 rounded-r-lg italic text-yellow-900 dark:text-yellow-200"}),r.querySelectorAll("hr").forEach(e=>{e.className="my-12 border-0 text-center",e.innerHTML='<span class="inline-block px-4 py-2 text-gray-400 dark:text-gray-600 text-xl">✦</span>'})}window.addEventListener("load",()=>{const r=localStorage.getItem("reading-font-size"),l=localStorage.getItem("reading-line-height"),a=localStorage.getItem("reading-theme");r&&s&&(s.style.fontSize=r+"px",document.querySelector(`[data-size="${r}"]`)?.click()),l&&s&&(s.style.lineHeight=l,document.querySelector(`[data-height="${l}"]`)?.click()),a&&document.querySelector(`[data-theme="${a}"]`)?.click(),k()});document.addEventListener("keydown",r=>{r.key==="Escape"&&(c?.classList.add("translate-x-full"),c?.classList.remove("translate-x-0"));const l=parseInt(window.location.pathname.split("/").pop()||"0");if(r.key==="ArrowLeft"){const a=document.querySelector(`[href*="chapter/${l-1}"]`);a&&a.click()}if(r.key==="ArrowRight"){const a=document.querySelector(`[href*="chapter/${l+1}"]`);a&&a.click()}});const p=document.querySelector(".bg-gradient-to-r.from-purple-500.to-pink-500");window.addEventListener("scroll",()=>{const r=document.documentElement.scrollHeight-window.innerHeight,l=window.scrollY/r*100;p&&(p.style.width=Math.min(l,100)+"%")});
